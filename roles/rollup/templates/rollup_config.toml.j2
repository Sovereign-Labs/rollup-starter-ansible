{{ rollup_da_config }}

[storage]
path = "{{ rollup_storage_dir }}"
state_cache_size = {{ rollup_state_cache_size }}
user_commit_concurrency = {{ rollup_state_user_commit_concurrency }}
user_hashtable_buckets = {{ rollup_state_user_hashtable_buckets }}
user_preallocate_ht = {{ rollup_state_user_preallocate_ht | lower }}
kernel_commit_concurrency = 2
pruner_versions_to_keep = 100

[runner]
da_polling_interval_ms = 2000
da_total_timeout_secs = 300
concurrent_sync_tasks = 2
pre_fetched_blocks_capacity = 4

[runner.http_config]
bind_host = "{{ rollup_http_host }}"
bind_port = {{ rollup_http_port }}

[monitoring]
telegraf_address = "127.0.0.1:8094"

[proof_manager]
aggregated_proof_block_jump = 1
# For now sequencer and prover same thing
prover_address = "{{ rollup_sequencer_address }}"
max_number_of_transitions_in_db = 100
max_number_of_transitions_in_memory = 20

[sequencer]
max_batch_size_bytes = {{ rollup_max_batch_size_bytes }}
max_concurrent_blobs = {{ rollup_max_concurrent_blobs }}
max_allowed_node_distance_behind = {{ rollup_max_allowed_node_distance_behind }}
rollup_address = "{{ rollup_sequencer_address }}"
blob_processing_timeout_secs = 60

{% if rollup_sequencer_kind == "preferred" %}
[sequencer.preferred]
disable_state_root_consistency_checks = true
recovery_strategy = "TryToSave"
batch_execution_time_limit_millis = 6000
ideal_lag_behind_finalized_slot = 1
num_cache_warmup_workers = 0
is_replica = {{ is_rollup_replica | lower }}
{% if rollup_sequencer_postgres_connection_string is defined and rollup_sequencer_postgres_connection_string | length > 0 %}
[sequencer.preferred.postgres_config]
postgres_connection_string = "{{ rollup_sequencer_postgres_connection_string }}"
node_id = "{{ rollup_node_id }}"
{% endif %}
{% else %}
[sequencer.standard]
{% endif %}

[sequencer.extension]
max_log_limit = 20000

{% if rollup_sequencer_kind == "preferred" and rollup_has_timing_oracle %}
[sequencer.preferred.timing_oracle]
priority_fee_percentage = 0
max_fee = 100_000_000
interval_millis = 50
{% endif %}

{% if rollup_sequencer_kind == "preferred" and rollup_rate_limiter_enabled %}
[sequencer.preferred.rate_limiter]
max_nb_of_concurrent_users_in_rate_limiter = {{ rollup_rate_limiter_max_concurrent_users }}
max_requests_per_second = {{ rollup_rate_limiter_max_requests_per_second }}
# Add requested limits onto hardcoded OFAC list taken from https://github.com/ultrasoundmoney/ofac-ethereum-addresses/blob/main/data.csv
address_custom_limits = [{% for item in rollup_rate_limiter_address_limits %}["{{ item.address }}", { resources_per_bucket = {{ item.resources_per_bucket }}, refill_rate = {{ item.refill_rate }} }],{% endfor %},
["0x098B716B8Aaf21512996dC57EB0615e2383E2f96", {resources_per_bucket = 0, refill_rate = 0}],
["0xa0e1c89Ef1a489c9C7dE96311eD5Ce5D32c20E4B", {resources_per_bucket = 0, refill_rate = 0}],
["0x3Cffd56B47B7b41c56258D9C7731ABaDc360E073", {resources_per_bucket = 0, refill_rate = 0}],
["0x53b6936513e738f44FB50d2b9476730C0Ab3Bfc1", {resources_per_bucket = 0, refill_rate = 0}],
["0x35fB6f6DB4fb05e6A4cE86f2C93691425626d4b1", {resources_per_bucket = 0, refill_rate = 0}],
["0xF7B31119c2682c88d88D455dBb9d5932c65Cf1bE", {resources_per_bucket = 0, refill_rate = 0}],
["0x3e37627dEAA754090fBFbb8bd226c1CE66D255e9", {resources_per_bucket = 0, refill_rate = 0}],
["0x08723392Ed15743cc38513C4925f5e6be5c17243", {resources_per_bucket = 0, refill_rate = 0}],
["0x7F367cC41522cE07553e823bf3be79A889DEbe1B", {resources_per_bucket = 0, refill_rate = 0}],
["0xd882cfc20f52f2599d84b8e8d58c7fb62cfe344b", {resources_per_bucket = 0, refill_rate = 0}],
["0x901bb9583b24d97e995513c6778dc6888ab6870e", {resources_per_bucket = 0, refill_rate = 0}],
["0xa7e5d5a720f06526557c513402f2e6b5fa20b008", {resources_per_bucket = 0, refill_rate = 0}],
["0x8576acc5c05d6ce88f4e49bf65bdf0c62f91353c", {resources_per_bucket = 0, refill_rate = 0}],
["0x1da5821544e25c636c1417ba96ade4cf6d2f9b5a", {resources_per_bucket = 0, refill_rate = 0}],
["0x7Db418b5D567A4e0E8c59Ad71BE1FcE48f3E6107", {resources_per_bucket = 0, refill_rate = 0}],
["0x72a5843cc08275C8171E582972Aa4fDa8C397B2A", {resources_per_bucket = 0, refill_rate = 0}],
["0x7F19720A857F834887FC9A7bC0a0fBe7Fc7f8102", {resources_per_bucket = 0, refill_rate = 0}],
["0x9f4cda013e354b8fc285bf4b9a60460cee7f7ea9", {resources_per_bucket = 0, refill_rate = 0}],
["0x3cbded43efdaf0fc77b9c55f6fc9988fcc9b757d", {resources_per_bucket = 0, refill_rate = 0}],
["0x2f389ce8bd8ff92de3402ffce4691d17fc4f6535", {resources_per_bucket = 0, refill_rate = 0}],
["0x19aa5fe80d33a56d56c78e82ea5e50e5d80b4dff", {resources_per_bucket = 0, refill_rate = 0}],
["0xe7aa314c77f4233c18c6cc84384a9247c0cf367b", {resources_per_bucket = 0, refill_rate = 0}],
["0x308ed4b7b49797e1a98d3818bff6fe5385410370", {resources_per_bucket = 0, refill_rate = 0}],
["0x67d40EE1A85bf4a4Bb7Ffae16De985e8427B6b45", {resources_per_bucket = 0, refill_rate = 0}],
["0x6f1ca141a28907f78ebaa64fb83a9088b02a8352", {resources_per_bucket = 0, refill_rate = 0}],
["0x48549a34ae37b12f6a30566245176994e17c6b4a", {resources_per_bucket = 0, refill_rate = 0}],
["0x5512d943ed1f7c8a43f3435c85f7ab68b30121b0", {resources_per_bucket = 0, refill_rate = 0}],
["0xc455f7fd3e0e12afd51fba5c106909934d8a0e4a", {resources_per_bucket = 0, refill_rate = 0}],
["0xfec8a60023265364d066a1212fde3930f6ae8da7", {resources_per_bucket = 0, refill_rate = 0}],
["0x7FF9cFad3877F21d41Da833E2F775dB0569eE3D9", {resources_per_bucket = 0, refill_rate = 0}],
["0x8Dce2aAC0dE82bdCAf6b4373B79f94331b8e4995", {resources_per_bucket = 0, refill_rate = 0}],
["0xf4377edA661e04B6DDA78969796Ed31658D602D4", {resources_per_bucket = 0, refill_rate = 0}],
["0xb338962B92CD818D6aef0A32a9ECD01212a71f33", {resources_per_bucket = 0, refill_rate = 0}],
["0x57EC89A0C056163A0314e413320f9B3ABe761259", {resources_per_bucket = 0, refill_rate = 0}],
["0xD8500C631dC32FA18645B7436344a99E4825e10e", {resources_per_bucket = 0, refill_rate = 0}],
["0x7CEd75026204aC29C34bEA98905D4C949F27361e", {resources_per_bucket = 0, refill_rate = 0}],
["0xc2a3829F459B3Edd87791c74cD45402BA0a20Be3", {resources_per_bucket = 0, refill_rate = 0}],
["0x3AD9dB589d201A710Ed237c829c7860Ba86510Fc", {resources_per_bucket = 0, refill_rate = 0}],
["0x83E5bC4Ffa856BB84Bb88581f5Dd62A433A25e0D", {resources_per_bucket = 0, refill_rate = 0}],
["0x08b2eFdcdB8822EfE5ad0Eae55517cf5DC544251", {resources_per_bucket = 0, refill_rate = 0}],
["0x04DBA1194ee10112fE6C3207C0687DEf0e78baCf", {resources_per_bucket = 0, refill_rate = 0}],
["0x0Ee5067b06776A89CcC7dC8Ee369984AD7Db5e06", {resources_per_bucket = 0, refill_rate = 0}],
["0x502371699497d08D5339c870851898D6D72521Dd", {resources_per_bucket = 0, refill_rate = 0}],
["0x5A14E72060c11313E38738009254a90968F58f51", {resources_per_bucket = 0, refill_rate = 0}],
["0xEFE301d259F525cA1ba74A7977b80D5b060B3ccA", {resources_per_bucket = 0, refill_rate = 0}],
["0xd0975b32cea532eadddfc9c60481976e39db3472", {resources_per_bucket = 0, refill_rate = 0}],
["0x1967d8af5bd86a497fb3dd7899a020e47560daaf", {resources_per_bucket = 0, refill_rate = 0}],
["0x39D908dac893CBCB53Cc86e0ECc369aA4DeF1A29", {resources_per_bucket = 0, refill_rate = 0}],
["0x4f47bc496083c727c5fbe3ce9cdf2b0f6496270c", {resources_per_bucket = 0, refill_rate = 0}],
["0x38735f03b30FbC022DdD06ABED01F0Ca823C6a94", {resources_per_bucket = 0, refill_rate = 0}],
["0x97b1043abd9e6fc31681635166d430a458d14f9c", {resources_per_bucket = 0, refill_rate = 0}],
["0xb6f5ec1a0a9cd1526536d3f0426c429529471f40", {resources_per_bucket = 0, refill_rate = 0}],
["0xe1d865c3d669dcc8c57c8d023140cb204e672ee4", {resources_per_bucket = 0, refill_rate = 0}],
["0x9c2bc757b66f24d60f016b6237f8cdd414a879fa", {resources_per_bucket = 0, refill_rate = 0}],
["0xdcbEfFBECcE100cCE9E4b153C4e15cB885643193", {resources_per_bucket = 0, refill_rate = 0}],
["0x5f48c2a71b2cc96e3f0ccae4e39318ff0dc375b2", {resources_per_bucket = 0, refill_rate = 0}],
["0x5a7a51bfb49f190e5a6060a5bc6052ac14a3b59f", {resources_per_bucket = 0, refill_rate = 0}],
["0xed6e0a7e4ac94d976eebfb82ccf777a3c6bad921", {resources_per_bucket = 0, refill_rate = 0}],
["0x797d7ae72ebddcdea2a346c1834e04d1f8df102b", {resources_per_bucket = 0, refill_rate = 0}],
["0x931546D9e66836AbF687d2bc64B30407bAc8C568", {resources_per_bucket = 0, refill_rate = 0}],
["0x43fa21d92141BA9db43052492E0DeEE5aa5f0A93", {resources_per_bucket = 0, refill_rate = 0}],
["0x6be0ae71e6c41f2f9d0d1a3b8d0f75e6f6a0b46e", {resources_per_bucket = 0, refill_rate = 0}],
["0x530a64c0ce595026a4a556b703644228179e2d57", {resources_per_bucket = 0, refill_rate = 0}],
["0x983a81ca6FB1e441266D2FbcB7D8E530AC2E05A2", {resources_per_bucket = 0, refill_rate = 0}],
["0x961c5be54a2ffc17cf4cb021d863c42dacd47fc1", {resources_per_bucket = 0, refill_rate = 0}],
["0xfac583c0cf07ea434052c49115a4682172ab6b4f", {resources_per_bucket = 0, refill_rate = 0}],
["0xE950DC316b836e4EeFb8308bf32Bf7C72a1358FF", {resources_per_bucket = 0, refill_rate = 0}],
["0x21B8d56BDA776bbE68655A16895afd96F5534feD", {resources_per_bucket = 0, refill_rate = 0}],
["0x175d44451403Edf28469dF03A9280c1197ADb92c", {resources_per_bucket = 0, refill_rate = 0}],
["0xf3701f445b6bdafedbca97d1e477357839e4120d", {resources_per_bucket = 0, refill_rate = 0}],
["0x19F8f2B0915Daa12a3f5C9CF01dF9E24D53794F7", {resources_per_bucket = 0, refill_rate = 0}],
["0x0931cA4D13BB4ba75D9B7132AB690265D749a5E7", {resources_per_bucket = 0, refill_rate = 0}],
["0x1999ef52700c34de7ec2b68a28aafb37db0c5ade", {resources_per_bucket = 0, refill_rate = 0}],
["0xd5ED34b52AC4ab84d8FA8A231a3218bbF01Ed510", {resources_per_bucket = 0, refill_rate = 0}],
["0x12de548F79a50D2bd05481C8515C1eF5183666a9", {resources_per_bucket = 0, refill_rate = 0}],
["0xdb2720ebad55399117ddb4c4a4afd9a4ccada8fe", {resources_per_bucket = 0, refill_rate = 0}],
["0xe3d35f68383732649669aa990832e017340dbca5", {resources_per_bucket = 0, refill_rate = 0}],
["0x532b77b33a040587e9fd1800088225f99b8b0e8a", {resources_per_bucket = 0, refill_rate = 0}],
["0x5d5b5dafecbf31bdb08bfd3edad4f2694372d0ef", {resources_per_bucket = 0, refill_rate = 0}],
["0xc103b7dc095c904b92081eef0c1640081ec01c10", {resources_per_bucket = 0, refill_rate = 0}],
["0xe1e4c5e5ed8f03ae61b581e2def126025f2b9401", {resources_per_bucket = 0, refill_rate = 0}]]
{% if rollup_rate_limiter_ip_limits | length > 0 %}
ip_custom_limits = [{% for item in rollup_rate_limiter_ip_limits %}["{{ item.ip }}", { resources_per_bucket = {{ item.resources_per_bucket }}, refill_rate = {{ item.refill_rate }} }]{% if not loop.last %}, {% endif %}{% endfor %}]
{% endif %}

[sequencer.preferred.rate_limiter.default_limits]
resources_per_bucket = {{ rollup_rate_limiter_default_resources_per_bucket }}
refill_rate = {{ rollup_rate_limiter_default_refill_rate }}
{% endif %}
