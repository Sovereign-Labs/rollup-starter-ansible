---
# Celestia DA configuration - connects to external Celestia RPC
# No local node installation required

- name: Check if Celestia secrets file exists
  stat:
    path: "{{ playbook_dir }}/vars/celestia_secrets.yaml"
  register: celestia_secrets_stat
  when: data_availability_role == 'celestia'

- name: load Celestia secrets from file (if not provided via runtime_vars)
  include_vars: "{{ playbook_dir }}/vars/celestia_secrets.yaml"
  when:
    - data_availability_role == 'celestia'
    - celestia_secrets_stat.stat.exists | default(false)
    - signer_private_key is not defined

- name: validate Celestia configuration
  assert:
    that:
      - signer_private_key is defined
      - signer_private_key | length == 64
      - celestia_rpc_url is defined
      - celestia_rpc_url | length > 0
      - celestia_grpc_url is defined
      - celestia_grpc_url | length > 0
    fail_msg: |
      Celestia configuration is incomplete:
      - 'signer_private_key' must be 64 characters (hex private key) in vars/celestia_secrets.yaml
      - 'celestia_rpc_url' must be set in vars/celestia_secrets.yaml
      - 'celestia_grpc_url' must be set in vars/celestia_secrets.yaml
