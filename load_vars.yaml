---
# Shared variable loading tasks - included by both setup.yaml and local.yml

- name: Check if custom overrides file exists
  stat:
    path: "{{ playbook_dir }}/vars/custom_overrides.yaml"
  register: custom_overrides_stat
  delegate_to: localhost
  run_once: true
  become: false

- name: Load custom overrides if present
  include_vars:
    file: "{{ playbook_dir }}/vars/custom_overrides.yaml"
  when: custom_overrides_stat.stat.exists

- name: Check if Celestia secrets file exists
  stat:
    path: "{{ playbook_dir }}/vars/celestia_secrets.yaml"
  register: celestia_secrets_stat
  delegate_to: localhost
  run_once: true
  become: false

- name: Load Celestia secrets from file (if not provided via extra vars)
  include_vars:
    file: "{{ playbook_dir }}/vars/celestia_secrets.yaml"
  when:
    - celestia_secrets_stat.stat.exists
    - signer_private_key is not defined

- name: Check if monitoring secrets file exists
  stat:
    path: "{{ playbook_dir }}/vars/monitoring_secrets.yaml"
  register: monitoring_secrets_stat
  delegate_to: localhost
  run_once: true
  become: false

- name: Load monitoring secrets from file (if not provided via extra vars)
  include_vars:
    file: "{{ playbook_dir }}/vars/monitoring_secrets.yaml"
  when:
    - monitoring_secrets_stat.stat.exists
    - grafana_loki_token is not defined or grafana_tempo_token is not defined

- name: Check if Hyperlane secrets file exists
  stat:
    path: "{{ playbook_dir }}/vars/hyperlane_secrets.yaml"
  register: hyperlane_secrets_stat
  delegate_to: localhost
  run_once: true
  become: false

- name: Debug monitoring secrets status
  debug:
    msg: "WARNING: influxdb_token not configured - telegraf metrics will be discarded"
  when: influxdb_token is not defined or influxdb_token == ""

- name: Load Hyperlane secrets from file (if not provided via extra vars)
  include_vars:
    file: "{{ playbook_dir }}/vars/hyperlane_secrets.yaml"
  when:
    - hyperlane_secrets_stat.stat.exists
    - hyperlane_validator_key is not defined

